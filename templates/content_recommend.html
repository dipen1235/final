<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Content-Based Movie Recommender</title>

    <!-- Bootstrap 3 -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>

    <style>
        /* ===== GLOBAL THEME ===== */
        body {
            background: radial-gradient(circle at top, #222 0%, #000 55%, #020716 100%);
            color: #fff;
            min-height: 100vh;
        }

        body.light-theme {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4ecf5 100%);
            color: #000;
        }

        /* ===== GLASS NAVBAR (non-floating) ===== */
        .glass-nav {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.55);
        }

        body.light-theme .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 20px;
            letter-spacing: 0.5px;
            color: #fff !important;
            transition: 0.3s;
        }

        body.light-theme .navbar-brand {
            color: #000 !important;
        }

        .nav > li > a {
            font-weight: 600;
            color: #ddd !important;
            font-size: 14px;
            padding: 8px 14px !important;
            border-radius: 999px;
            transition: 0.2s ease;
        }

        .nav > li > a:hover {
            background: rgba(255, 255, 255, 0.12);
            color: #fff !important;
        }

        .nav > li.active > a {
            background: linear-gradient(135deg, #2962ff, #00bcd4);
            color: #fff !important;
            box-shadow: 0 0 14px rgba(0, 188, 212, 0.8);
        }

        body.light-theme .nav > li > a {
            color: #444 !important;
        }

        body.light-theme .nav > li > a:hover {
            background: rgba(0, 0, 0, 0.06);
            color: #000 !important;
        }

        body.light-theme .nav > li.active > a {
            box-shadow: 0 0 14px rgba(33, 150, 243, 0.7);
        }

        .btn-theme-toggle {
            background: linear-gradient(135deg, #00c853, #64dd17);
            border: none;
            font-weight: 600;
            padding: 6px 16px;
            border-radius: 999px;
            color: white !important;
            box-shadow: 0 4px 12px rgba(0, 200, 83, 0.35);
            transition: 0.2s;
        }

        .btn-theme-toggle:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 200, 83, 0.55);
        }

        /* ===== PAGE WRAPPER ===== */
        .page-wrapper {
            max-width: 1100px;
            margin: 40px auto 60px auto;
            text-align: center;
        }

        .page-title {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .page-subtitle {
            font-size: 15px;
            color: #bbbbbb;
            margin-bottom: 12px;
        }

        body.light-theme .page-subtitle {
            color: #555;
        }

        .status-line {
            font-size: 12px;
            margin-bottom: 10px;
        }

        .status-ok {
            color: #4caf50;
        }

        .status-bad {
            color: #ff5252;
        }

        .error-text {
            color: #ff8080;
            font-size: 12px;
            margin-bottom: 10px;
        }

        /* ===== SEARCH FORM ===== */
        .search-form {
            max-width: 500px;
            margin: 10px auto 0 auto;
        }

        .btn-main-content {
            background: linear-gradient(135deg, #2962ff, #00bcd4);
            border: none;
            padding: 8px 26px;
            border-radius: 999px;
            font-weight: bold;
            color: #fff;
            margin-top: 12px;
            box-shadow: 0 4px 12px rgba(33,150,243,0.45);
        }

        .btn-main-content:hover {
            opacity: 0.95;
            box-shadow: 0 6px 16px rgba(33,150,243,0.7);
        }

        /* ===== SELECT2 DARK/LIGHT ===== */
        .select2-container--default .select2-selection--single {
            background-color: #fff;
            border: 1px solid #555;
            border-radius: 4px;
            height: 34px;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            color: #000;
            line-height: 32px;
            padding-left: 8px;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 32px;
        }

        .select2-dropdown {
            background-color: #fff;
            border: 1px solid #555;
        }

        .select2-results__option {
            color: #000;
        }

        .select2-results__option--highlighted {
            background-color: #2962ff !important;
            color: #fff !important;
        }

        /* ===== MOVIE GRID ===== */
        .movie-grid {
            margin-top: 25px;
        }

        .movie-card {
            width: 170px;
            display: inline-block;
            vertical-align: top;
            margin: 14px 10px;
        }

        .movie-card .card {
            height: 360px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 14px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 22px rgba(0,0,0,0.55);
        }

        .movie-card .card:hover {
            box-shadow: 0 12px 30px rgba(0,0,0,0.85);
            border-color: rgba(41, 98, 255, 0.8);
        }

        body.light-theme .movie-card .card {
            background: #ffffff;
            border-color: rgba(0,0,0,0.08);
            box-shadow: 0 8px 18px rgba(0,0,0,0.1);
        }

        body.light-theme .movie-card .card:hover {
            box-shadow: 0 12px 26px rgba(0,0,0,0.18);
            border-color: rgba(41, 98, 255, 0.6);
        }

        .movie-poster {
            width: 100%;
            height: 230px;
            object-fit: cover;
            border-radius: 8px;
        }

        .movie-title {
            height: 32px;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 13px;
            margin-top: 8px;
        }

        .movie-year {
            height: 14px;
            margin-bottom: 6px;
            font-size: 12px;
            opacity: 0.8;
        }

        .rating-stars {
            height: 16px;
            font-size: 11px;
            color: #ffc107;
        }

        .card-body {
            margin-top: auto;
            text-align: center;
        }

        .info-btn {
            margin-top: 5px;
        }
    </style>
</head>
<body>

<nav class="navbar glass-nav">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="{{ url_for('home') }}">My Movie Recommender</a>
        </div>

        <ul class="nav navbar-nav">
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li class="active"><a href="{{ url_for('content_page') }}">Content Based</a></li>
            <li><a href="{{ url_for('collab_page') }}">Collaborative</a></li>
        </ul>

        <button id="themeToggle" class="btn btn-theme-toggle navbar-btn navbar-right">
            Light Mode
        </button>
    </div>
</nav>

<div class="page-wrapper">

    <h1 class="page-title">Content-Based Recommendations</h1>
    <div class="page-subtitle">
        Pick a movie you like – we'll recommend titles with similar content and features.
    </div>

    {% if model_loaded is defined %}
        <div class="status-line">
            {% if model_loaded %}

            {% else %}
                <span class="status-bad">Model status: NOT loaded ❌</span>
            {% endif %}
        </div>
    {% endif %}

    {% if error %}
        <div class="error-text">
            {{ error }}
        </div>
    {% endif %}

    <!-- Search -->
    <form method="POST" action="{{ url_for('content_page') }}" class="search-form">
        <select id="movieSelect" name="movie_name" class="form-control">
            {% for movie in movie_list %}
                <option value="{{ movie }}" {% if selected_movie == movie %}selected{% endif %}>
                    {{ movie }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-main-content">
            Show Recommendations
        </button>
    </form>

    <!-- Recommendations -->
    {% if recommendations %}
        <div class="movie-grid">
            {% for rec in recommendations %}
                <div class="movie-card">
                    <div class="card">
                        <div class="card-body">

                            {% if rec.poster %}
                                <img src="{{ rec.poster }}" alt="{{ rec.title }}" class="movie-poster">
                            {% endif %}

                            <div class="movie-title">
                                {{ rec.title }}
                            </div>

                            {% if rec.year %}
                                <div class="movie-year">
                                    ({{ rec.year }})
                                </div>
                            {% endif %}

                            {% if rec.rating_5 is defined %}
                                <div class="rating-stars">
                                    {% set full = rec.rating_5|round(0,'floor')|int %}
                                    {% set half = 1 if rec.rating_5 - full >= 0.5 else 0 %}
                                    {% set empty = 5 - full - half %}
                                    {% for _ in range(full) %}★{% endfor %}
                                    {% if half %}☆{% endif %}
                                    {% for _ in range(empty) %}☆{% endfor %}
                                    ({{ rec.rating_5 }}/5)
                                </div>
                            {% endif %}

                            <!-- INFO BUTTON -->
                            <button class="btn btn-info btn-xs info-btn"
                                    onclick="showInfoModal(
                                        '{{ rec.title|escape }}',
                                        '{{ rec.year|default('N/A') }}',
                                        '{{ rec.poster|default('') }}',
                                        `{{ rec.details|default('No details available')|replace('`','\\`') }}`,
                                        '{{ rec.rating_5|default('N/A') }}'
                                    )">
                                Info
                            </button>

                            <!-- TRAILER BUTTON -->
                            <button class="btn info-btn btn-primary btn-xs"
                                    onclick="openTrailer({{ rec.movie_id }})">
                                Trailer
                            </button>

                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}

</div>

<!-- Info Modal -->
<div id="infoModal" class="modal fade">
  <div class="modal-dialog modal-sm">
    <div class="modal-content" style="background:#111; color:#fff; border-radius:10px;">
      <div class="modal-header">
        <button class="close" onclick="$('#infoModal').modal('hide')" style="color:#fff;">×</button>
        <h4 class="modal-title" id="infoTitle"></h4>
      </div>
      <div class="modal-body" style="text-align:center;">

        <img id="infoPoster"
             src=""
             style="width:100%; border-radius:8px; margin-bottom:10px;">

        <p><strong>Year:</strong> <span id="infoYear"></span></p>
        <p><strong>Rating:</strong> <span id="infoRating"></span></p>
        <p style="margin-top:10px;"><strong>Overview:</strong></p>
        <p id="infoDetails" style="white-space:pre-line; text-align:left;"></p>

      </div>
    </div>
  </div>
</div>

<!-- Trailer Modal -->
<div id="trailerModal" class="modal fade">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="background:#000;">
      <div class="modal-header">
        <button class="close" onclick="closeTrailer()" style="color:white;">×</button>
        <h4 class="modal-title">Movie Trailer</h4>
      </div>
      <div class="modal-body">
        <iframe id="trailerIframe" width="100%" height="450" frameborder="0"
                allowfullscreen></iframe>
      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
var TMDB_API_KEY = "c4e0cda33ee220d70e5882632cec6bc8";

/* -------- TRAILER -------- */
function openTrailer(movieId) {
    $.getJSON(
        "https://api.themoviedb.org/3/movie/" + movieId + "/videos?api_key=" + TMDB_API_KEY + "&language=en-US",
        function(data) {
            if (data.results && data.results.length > 0) {
                let t = data.results.find(v => v.site === "YouTube" && v.type === "Trailer") || data.results[0];
                $("#trailerIframe").attr("src", "https://www.youtube.com/embed/" + t.key);
                $("#trailerModal").modal("show");
            } else {
                alert("Trailer not available.");
            }
        }
    ).fail(function() {
        alert("Failed to load trailer.");
    });
}

function closeTrailer() {
    $("#trailerIframe").attr("src", "");
    $("#trailerModal").modal("hide");
}

/* -------- INFO MODAL -------- */
function showInfoModal(title, year, poster, details, rating) {
    $("#infoTitle").text(title);
    $("#infoYear").text(year);
    $("#infoPoster").attr("src", poster || "https://via.placeholder.com/300x450?text=No+Image");
    $("#infoDetails").text(details);
    $("#infoRating").text(rating);
    $("#infoModal").modal("show");
}

/* -------- THEME + SELECT2 -------- */
$(document).ready(function() {
    $('#movieSelect').select2({ width:"100%", placeholder:"Search movie..." });

    function applyTheme(theme) {
        if (theme === 'light') {
            $('body').addClass('light-theme');
            $('#themeToggle').text('Dark Mode');
        } else {
            $('body').removeClass('light-theme');
            $('#themeToggle').text('Light Mode');
        }
    }

    applyTheme(localStorage.getItem('theme') || 'dark');

    $('#themeToggle').on('click', function() {
        const next = $('body').hasClass('light-theme') ? 'dark' : 'light';
        localStorage.setItem('theme', next);
        applyTheme(next);
    });
});
</script>

</body>
</html>
